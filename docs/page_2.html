<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Aaron Max Wiedemer">
<meta name="dcterms.date" content="2024-07-02">

<title>OSC_labmeeting_wiedemer_20240624 - Using Software in OSC</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">OSC_labmeeting_wiedemer_20240624</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">OSC and CLI Crash Course</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./page_2.html" rel="" target="" aria-current="page">
 <span class="menu-text">Software at OSC</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#meeting-objectives" id="toc-meeting-objectives" class="nav-link active" data-scroll-target="#meeting-objectives">Meeting objectives</a></li>
  <li><a href="#available-software-at-osc" id="toc-available-software-at-osc" class="nav-link" data-scroll-target="#available-software-at-osc">1. Available software at OSC</a>
  <ul class="collapse">
  <li><a href="#checking-available-programs" id="toc-checking-available-programs" class="nav-link" data-scroll-target="#checking-available-programs">1.1 Checking available programs</a></li>
  <li><a href="#loading-software" id="toc-loading-software" class="nav-link" data-scroll-target="#loading-software">1.2 Loading software</a>
  <ul class="collapse">
  <li><a href="#loading-modules-with-module-load" id="toc-loading-modules-with-module-load" class="nav-link" data-scroll-target="#loading-modules-with-module-load">loading modules with <code>module load</code></a></li>
  <li><a href="#unloading-modules" id="toc-unloading-modules" class="nav-link" data-scroll-target="#unloading-modules">unloading modules</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#how-to-use-software-that-is-not-already-available-in-osc" id="toc-how-to-use-software-that-is-not-already-available-in-osc" class="nav-link" data-scroll-target="#how-to-use-software-that-is-not-already-available-in-osc">2 How to use software that is not already available in OSC</a>
  <ul class="collapse">
  <li><a href="#conda-intro" id="toc-conda-intro" class="nav-link" data-scroll-target="#conda-intro">2.1 Conda Intro</a></li>
  <li><a href="#activating-a-conda-environment" id="toc-activating-a-conda-environment" class="nav-link" data-scroll-target="#activating-a-conda-environment">2.2 Activating a Conda environment</a></li>
  <li><a href="#creating-your-own-conda-enviroments" id="toc-creating-your-own-conda-enviroments" class="nav-link" data-scroll-target="#creating-your-own-conda-enviroments">2.3 Creating your own conda enviroments</a>
  <ul class="collapse">
  <li><a href="#one-time-setup" id="toc-one-time-setup" class="nav-link" data-scroll-target="#one-time-setup">One-time setup</a></li>
  </ul></li>
  <li><a href="#conda-example---kraken2" id="toc-conda-example---kraken2" class="nav-link" data-scroll-target="#conda-example---kraken2">2.4 Conda Example - kraken2</a>
  <ul class="collapse">
  <li><a href="#lets-make-a-folder-to-store-our-conda-enviroments" id="toc-lets-make-a-folder-to-store-our-conda-enviroments" class="nav-link" data-scroll-target="#lets-make-a-folder-to-store-our-conda-enviroments">Lets make a folder to store our conda enviroments</a></li>
  <li><a href="#setup-code" id="toc-setup-code" class="nav-link" data-scroll-target="#setup-code">Setup code</a></li>
  <li><a href="#installing-kraken2" id="toc-installing-kraken2" class="nav-link" data-scroll-target="#installing-kraken2">Installing <code>kraken2</code></a></li>
  <li><a href="#exiting-a-conda-enviroment-with-conda-deactivate" id="toc-exiting-a-conda-enviroment-with-conda-deactivate" class="nav-link" data-scroll-target="#exiting-a-conda-enviroment-with-conda-deactivate">Exiting a conda enviroment with <code>conda deactivate</code></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#moving-data---file-transfer" id="toc-moving-data---file-transfer" class="nav-link" data-scroll-target="#moving-data---file-transfer">3 Moving data - file transfer</a>
  <ul class="collapse">
  <li><a href="#sftp" id="toc-sftp" class="nav-link" data-scroll-target="#sftp">3.1 SFTP</a>
  <ul class="collapse">
  <li><a href="#steps-to-get-and-use-filezilla" id="toc-steps-to-get-and-use-filezilla" class="nav-link" data-scroll-target="#steps-to-get-and-use-filezilla">Steps to get and use FIleZilla</a></li>
  </ul></li>
  <li><a href="#globus" id="toc-globus" class="nav-link" data-scroll-target="#globus">3.2 Globus</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Using Software in OSC</h1>
  <div class="quarto-categories">
    <div class="quarto-category">command line</div>
    <div class="quarto-category">OSC</div>
    <div class="quarto-category">Unix</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Aaron Max Wiedemer </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 2, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="meeting-objectives" class="level2">
<h2 class="anchored" data-anchor-id="meeting-objectives">Meeting objectives</h2>
<ul>
<li>Learn how programs at OSC work
<ul>
<li>Available programs</li>
<li>Unavailable programs
<ul>
<li>Conda enviroments</li>
</ul></li>
</ul></li>
<li>Get introduced to how to transfer data
<ul>
<li>SFTP</li>
<li>Globus</li>
</ul></li>
</ul>
<p>Analysis of omics data sets, especially in genomics and transcriptomics, often involves using a sequence of specialized software (e.g., within our group, use MSconvert -&gt; Mzmine -&gt; GNPS, R)</p>
<p>Many analysis pipelines involve software accessible through the Unix shell (i.e., FastQC) and it is my goal to introduce you all to how utilize software in the Unix shell at OSC.</p>
<p>Obtaining and utilizing software at the OSC depends on weather or not the programs are already available through the OSC or are not and need imported. For the case of unavailable software, I’ll be showing how to use the <strong>Conda</strong> software management system.</p>
<p>Knowing how to use software is great, but useless if we don’t know how to import our data to be analyzed, so I’ll also be going over a little of that today with <strong>SFTP</strong> and <strong>Globus</strong> .</p>
</section>
<section id="available-software-at-osc" class="level1">
<h1>1. Available software at OSC</h1>
<p>The OSC comes “pre-packed” with some common system wide programs that only need to be loaded before use.</p>
<p>OSC software is managed with the <code>Lmod</code> system which allows us access to a lot of different downloaded programs, but requires that we have to explicitly load a program before use. The upside of this is that we can have many different versions of the same software available to us at once.</p>
<blockquote class="blockquote">
<p>If you’re coming from an R background, I like to think of this like requiring packages to be loaded in a script before we use them, even though we already have them downloaded.</p>
</blockquote>
<p>To load, unload, and search for available software, we use the <code>module</code> set of commands</p>
<section id="checking-available-programs" class="level2">
<h2 class="anchored" data-anchor-id="checking-available-programs">1.1 Checking available programs</h2>
<p>There are a few ways to do this!</p>
<pre><code>1. Just look it up [here](https://www.osc.edu/resources/available_software/software_list)
2. Within the shell, we can see the available software with
- __module spider__ : lists all installed modules
- __module avail__ : lists all software that are currently available to be directly loaded given the current working environment</code></pre>
<section id="example---lets-look-at-the-available-versions-of-git" class="level4">
<h4 class="anchored" data-anchor-id="example---lets-look-at-the-available-versions-of-git">Example - Lets look at the available versions of git</h4>
<p>first using <code>module spider</code></p>
<blockquote class="blockquote">
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> spider git</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="bash-out"><code>-------------------------------------------------------------------------------------------
 git:
-------------------------------------------------------------------------------------------
    Versions:
       git/2.18.0
       git/2.27.1
       git/2.39.0

-------------------------------------------------------------------------------------------
 For detailed information about a specific "git" module (including how to load the modules) use the module's full name.
 For example:

    $ module spider git/2.39.0
-------------------------------------------------------------------------------------------</code></pre>
</blockquote>
<p>next using <code>module avail</code></p>
<blockquote class="blockquote">
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> avail git</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="bash-out"><code>--------------------------------------- Global Aliases ----------------------------------------
  intelmpi/2021.5.0 -&gt; intelmpi/2021.5    oneapi/2023.2.0 -&gt; intel-oneapi/2023.2.0

------------------------------------ /apps/lmodfiles/Core -------------------------------------
  git/2.18.0 (L,D)    git/2.27.1    git/2.39.0

 Where:
  L:  Module is loaded
  D:  Default Module

Use "module spider" to find all possible modules.
Use "module keyword key1 key2 ..." to search for all possible modules matching any of the
"keys".</code></pre>
</blockquote>
<p>From this we can see a few key pieces of information</p>
<pre><code>1. Different versions of software are available and listed through OSC
2. In this case, all of the installed modules match the available modules
3. Only `module avail` gives information on what is the default program loaded (indicated with a `D`) and if it is already loaded (indicated with an `L`)</code></pre>
<p>There also is actually a bunch of software already loaded by default in the OSC! At any point we can see what software is loaded by using <code>module list</code></p>
<blockquote class="blockquote">
<div class="sourceCode" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> list</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="bash-out"><code>Currently Loaded Modules:
1) xalt/latest               4) mvapich2/2.3.3     7) git/2.18.0
2) gcc-compatibility/8.4.0   5) modules/sp2020     8) app_code_server/4.8.3
3) intel/19.0.5              6) project/ondemand</code></pre>
</blockquote>
</section>
</section>
<section id="loading-software" class="level2">
<h2 class="anchored" data-anchor-id="loading-software">1.2 Loading software</h2>
<p>What about software that is available, but is not already loaded?</p>
<p>Lets check out the module <code>miniconda</code> which is a useful program used to install outside programs that we’ll use later</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> avail miniconda</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="bash-out"><code>--------------------------------------- Global Aliases ----------------------------------------
   intelmpi/2021.5.0 -&gt; intelmpi/2021.5    oneapi/2023.2.0 -&gt; intel-oneapi/2023.2.0

------------------------------------ /apps/lmodfiles/Core -------------------------------------
   miniconda3/4.10.3-py37 (D)    miniconda3/4.12.0-py39     miniconda3/24.1.2-py310
   miniconda3/4.12.0-py38        miniconda3/23.3.1-py310

  Where:
   D:  Default Module

Use "module spider" to find all possible modules.
Use "module keyword key1 key2 ..." to search for all possible modules matching any of the
"keys".</code></pre>
<p>We can see that the default version is <code>miniconda3/4.10.3-py37 (D)</code>, but it is not currently loaded</p>
<p><br></p>
<p><br></p>
<section id="loading-modules-with-module-load" class="level3">
<h3 class="anchored" data-anchor-id="loading-modules-with-module-load">loading modules with <code>module load</code></h3>
<p>To load available modules, we use <code>module load</code></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load a module</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load miniconda3 <span class="co"># loads the default version</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can also specify which version of a program you load</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load miniconda3/4.10.3-py37 <span class="co"># loads a specific version - usually better to do for replicability</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="unloading-modules" class="level3">
<h3 class="anchored" data-anchor-id="unloading-modules">unloading modules</h3>
<p>Occasionally, it may be useful to unload a module, such as when you have conflicting versions</p>
<ul>
<li>We can unload a specific module with <code>module unload &lt;module name&gt;</code></li>
<li>To unload <strong>all</strong> modules use <code>module purge</code></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled" title="A note on software in scripts">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
A note on software in scripts
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>If you’re ever running scripts, make sure the modules you want to use are loaded at the top of the script! (very similar to making sure your libraries are loaded in R)</p>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="how-to-use-software-that-is-not-already-available-in-osc" class="level1">
<h1>2 How to use software that is not already available in OSC</h1>
<p>Using the <code>module</code> commands to load software is limited to the software already available in OSC, but there may be programs outside of OSC you desire to use</p>
<p>According to Jelmer here are two of the most useful l ways we can use external software - <strong>Containers</strong>, which are self-contained software environments that include operating systems, akin to mini virtual machines. Docker containers are most well-known, but OSC uses Apptainer (formerly known as Singularity). - <strong>Conda</strong>, which creates software enviroments similar to the <code>Lmod</code> system</p>
<p>In addition to being able to use external programs, using these methods also allows us to bypass any issues with admin privileges and other software dependencies you may encounter</p>
<p>I use conda the most, so we’ll be going over how to use that here</p>
<section id="conda-intro" class="level2">
<h2 class="anchored" data-anchor-id="conda-intro">2.1 Conda Intro</h2>
<p>With conda, we can create what are called <strong>environments</strong> in which we can install one or more software packages</p>
<p>As long as a program is available in one of the online Conda repositories, which most bioinformatics programs are, it is fairly straightforward to download and run (similar to CRAN in R)</p>
<p>A conda environment is essentially a dir that contains an executable program. I like to think of it essentially as an application.</p>
<p>I generally recommend keeping your conda environments together</p>
<p>Here are some I have</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> users/awiedemer673/conda/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="bash-out"><code>conda_program_list.md  mzmine  proteowizard kraken2_2.1.3</code></pre>
<p>Each environment is one separate program, similar to what we saw with the <code>Lmod</code> earlier (or think of it as my installed packages)</p>
</section>
<section id="activating-a-conda-environment" class="level2">
<h2 class="anchored" data-anchor-id="activating-a-conda-environment">2.2 Activating a Conda environment</h2>
<p>While the term <code>load</code> is used for the <code>Lmod</code> system, conda environments use the term <code>activate</code> - it really means the same thing, that we make a program ready to use</p>
<p>Similar to the <code>module</code> family, when using the conda environment we use the <code>conda</code> family of commands which includes</p>
<ul>
<li><code>conda activate</code> : activates a conda environment</li>
<li><code>conda deactivate</code> : deactivates a conda environment</li>
<li><code>conda create</code> : creates a conda environment if one does not already exist</li>
<li><code>conda install</code> : intalls a conda environment</li>
<li><code>conda update</code> : updates a conda environment</li>
</ul>
<p>e.g.,</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> activate ls users/awiedemer673/conda/proteowizard</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Unlike the <code>Lmod</code> system, the conda can only have one active environment at a time. If you activate another conda environment, the previous one will automatically be deactivated</p>
<p>This may seem like a hassle, but forces you to get in the habit of having a different script for every program you may use in your analysis pipeline</p>
<div class="callout callout-style-default callout-note callout-titled" title="conda only work if miniconda3 is running">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
conda only work if miniconda3 is running
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>We activate conda environments using the <code>miniconda3</code> module we saw earlier, which is not pre-loaded into the OSC, so whenever we use a conda environment remember to <code>module load miniconda3</code> !</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># if you are running a conda enviroment, it should look like this at some point</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load miniconda3</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> activate ./<span class="op">&lt;</span>conda environment<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="creating-your-own-conda-enviroments" class="level2">
<h2 class="anchored" data-anchor-id="creating-your-own-conda-enviroments">2.3 Creating your own conda enviroments</h2>
<section id="one-time-setup" class="level3">
<h3 class="anchored" data-anchor-id="one-time-setup">One-time setup</h3>
<p>Before we can use conda to download anything, we need to do a little bit of setup - but don’t worry, this only needs to be done once.</p>
<p>Essentially we need to set up what repositories we will have access to by using <code>conda config</code></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> config <span class="at">--add</span> channels defaults   <span class="co">#added first -&gt; lowest priority</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> config <span class="at">--add</span> channels bioconda</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> config <span class="at">--add</span> channels conda-forge <span class="co">#added last -&gt; highest priority</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Lets check to see if we got the right repos</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> config <span class="at">--get</span> channels</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>It should return the following</p>
<pre class="bash-out"><code>--add channels 'defaults' # lowest priority 
--add channels 'bioconda'
 --add channels 'conda-forge' # highest priority</code></pre>
</section>
</section>
<section id="conda-example---kraken2" class="level2">
<h2 class="anchored" data-anchor-id="conda-example---kraken2">2.4 Conda Example - kraken2</h2>
<section id="lets-practice-downloading-a-conda-envrironment-using-kraken2-as-an-example" class="level5">
<h5 class="anchored" data-anchor-id="lets-practice-downloading-a-conda-envrironment-using-kraken2-as-an-example">Lets practice downloading a conda envrironment using kraken2 as an example</h5>
<p><br></p>
<p><code>kraken2</code> is a piece of bioinformatics software that assigns taxonomy of metagenomic data using a k-mers based approach</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/k_mers.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption class="figure-caption">k-mers algorithm illustration</figcaption>
</figure>
</div>
<p>I’m not going to get super into the specifics of how it works, but to get kraken2 to work you need to first set up a database to compare your data to, and then run the kraken2 software to see if there are any matches to the database.</p>
<p>If we look in the module list for kraken2, we can see its not there, requiring us to use the conda environment to use it</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> avail kraken2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="bash-out"><code>--------------------------------------- Global Aliases ----------------------------------------
   intelmpi/2021.5.0 -&gt; intelmpi/2021.5    oneapi/2023.2.0 -&gt; intel-oneapi/2023.2.0
No modules found!
Use "module spider" to find all possible modules.
Use "module keyword key1 key2 ..." to search for all possible modules matching any of the
"keys".</code></pre>
<p><br></p>
</section>
<section id="lets-make-a-folder-to-store-our-conda-enviroments" class="level3">
<h3 class="anchored" data-anchor-id="lets-make-a-folder-to-store-our-conda-enviroments">Lets make a folder to store our conda enviroments</h3>
<p>Before we download anything, lets first make a dir to store your conda environments</p>
<div class="callout callout-style-default callout-note callout-titled" title="A note on where to put your conda enviroments">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
A note on where to put your conda enviroments
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Generally, there are two good options for where to keep your conda environments</p>
<ol type="1">
<li><p>Have <strong>one large dir containing all of the conda environments</strong> you use in all of your projects (less hassle, but less reproducible if you want someone else to see what programs you use and how you got them)</p></li>
<li><p>Have <strong>one conda environment containing dir per project</strong> with all of the relevant environments for that project (more work, but more reproducible)</p></li>
</ol>
<p>You choose what you want to do - I have one big dir with all of my envrioments alongside a markdown document describing the code I used to download each</p>
</div>
</div>
</div>
</section>
<section id="setup-code" class="level3">
<h3 class="anchored" data-anchor-id="setup-code">Setup code</h3>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get to your user dir</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ./<span class="va">$USER</span>/</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># make a folder called conda</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> ./conda/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="installing-kraken2" class="level3">
<h3 class="anchored" data-anchor-id="installing-kraken2">Installing <code>kraken2</code></h3>
<p>Now lets install <code>kraken2</code></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ./conda   <span class="co">#gets me to the place I want to install stuff in</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Of course load miniconda3</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load miniconda3/24.1.2-py310</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>lets get kraken</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> create <span class="at">-y</span> <span class="at">-p</span> ./kraken2 <span class="at">-c</span> bioconda kraken2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Breaking down that code</p>
<pre><code>- `conda` is the family of commands we are using
- `create` is the sub-command that is used to create an environment
- The `-n` argument specifies the name you are going to give this environment. Here I have said `proteowizard` but should also likely have included what version it is in the name
- `-c` says what repository to install the environment from, in this case bioconda
- The end doesn't have an argument, but it’s the name of the program we want to install</code></pre>
<p><br></p>
<div class="callout callout-style-default callout-tip callout-titled" title="Software versions">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Software versions
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>By default, conda will install the <strong>latest available version</strong> of the program</p>
<p>To specify a version, use the equal sign after the program name</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> create <span class="at">-y</span> <span class="at">-p</span> ./kraken2_2.1.3 <span class="at">-c</span> bioconda kraken2=2.1.3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This is probably the better way to do it as you may run into trouble if you download a newer version of a program to the same name</p>
</div>
</div>
</div>
<p><br></p>
<section id="lets-try-it-out" class="level4">
<h4 class="anchored" data-anchor-id="lets-try-it-out">Let’s try it out!!</h4>
<div class="sourceCode" id="cb28"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> activate ./kraken2_2.1.3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Also - notice how the command line has changed a little - you should notice you have something like this on your screen specifying that you have an activated conda environment</p>
<pre class="bash-out"><code>/fs/ess/PAS1640/users/awiedemer673/conda/kraken2_2.1.3)</code></pre>
<p><br></p>
<p>Now we can use the kraken2 commands like any other - lets learn a little about it</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kraken2</span> <span class="at">--help</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="bash-out"><code>Usage: kraken2 [options] &lt;filename(s)&gt;

Options:
  --db NAME               Name for Kraken 2 DB
                          (default: none)
  --threads NUM           Number of threads (default: 1)
  --quick                 Quick operation (use first hit or hits)
  --unclassified-out FILENAME
                          Print unclassified sequences to filename
  --classified-out FILENAME
                          Print classified sequences to filename
  --output FILENAME       Print output to filename (default: stdout); "-" will
                          suppress normal output
  --confidence FLOAT      Confidence score threshold (default: 0.0); must be
                          in [0, 1].
  --minimum-base-quality NUM
                          Minimum base quality used in classification (def: 0,
                          only effective with FASTQ input).
  --report FILENAME       Print a report with aggregrate counts/clade to file
  --use-mpa-style         With --report, format report output like Kraken 1's
                          kraken-mpa-report
  --report-zero-counts    With --report, report counts for ALL taxa, even if
                          counts are zero
  --report-minimizer-data With --report, report minimizer and distinct minimizer
                          count information in addition to normal Kraken report
  --memory-mapping        Avoids loading database into RAM
  --paired                The filenames provided have paired-end reads
  --use-names             Print scientific names instead of just taxids
  --gzip-compressed       Input files are compressed with gzip
  --bzip2-compressed      Input files are compressed with bzip2
  --minimum-hit-groups NUM
                          Minimum number of hit groups (overlapping k-mers
                          sharing the same minimizer) needed to make a call
                          (default: 2)
  --help                  Print this message
  --version               Print version information

If none of the *-compressed flags are specified, and the filename provided
is a regular file, automatic format detection is attempted.
</code></pre>
<p>So kraken2 has a lot of options, but we can see that its activated because it allows us to run the <code>--help</code> argument</p>
</section>
</section>
<section id="exiting-a-conda-enviroment-with-conda-deactivate" class="level3">
<h3 class="anchored" data-anchor-id="exiting-a-conda-enviroment-with-conda-deactivate">Exiting a conda enviroment with <code>conda deactivate</code></h3>
<p>To deactivate a conda enviroment, all we need to use is <code>conda deactivate</code> - that’s literally it</p>
<div class="callout callout-style-default callout-note callout-titled" title="Conda resources">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Conda resources
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>if you every want to check if a program is available through bioconda, check the website</p>
<ul>
<li><strong>https://bioconda.github.io/index.html</strong> : the bioconda website, search for available programs</li>
</ul>
<p>It also has programs such as proteowizard and MZmine</p>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="moving-data---file-transfer" class="level1">
<h1>3 Moving data - file transfer</h1>
<p>Knowing how to get and use software is great, but we need to know how to transfer our data if we are to use any software.</p>
<p>Today I want to mention two useful ways to transfer your data to your OSC account:</p>
<ul>
<li><strong>SFTP</strong> (secure file transfer protocol)</li>
<li><strong>Globus</strong> (which DQ has a wonderful protocol for in Cooperstone Lab/Data processing PC/Globus/ )</li>
</ul>
<section id="sftp" class="level2">
<h2 class="anchored" data-anchor-id="sftp">3.1 SFTP</h2>
<p><strong>SFTP</strong> stands for secure file transfer protocol and is a general way to transfer files (if you’ve ever transferred data from MZmine to GNPS, you have used FTP which is similar). There are many GUI-based SFTP applications you can use, here I’ll show how to get <strong>FIleZilla</strong> as it works on most operating systems (and is the one Jelmer showed me how to use).</p>
<section id="steps-to-get-and-use-filezilla" class="level3">
<h3 class="anchored" data-anchor-id="steps-to-get-and-use-filezilla">Steps to get and use FIleZilla</h3>
<ol type="1">
<li>Go to the <a href="https://filezilla-project.org/download.php?type=client">FileZilla download page</a> and download the program toy your local system</li>
<li>To connect to OSC find the sit manager (file &gt; site manager)</li>
<li>Click my sites</li>
<li>In General choose the following
<ol type="a">
<li>Protocol: SFTP - SSH File Transfer Protocol</li>
<li>Host: sftp.osc.edu</li>
<li>Port - leave blank</li>
<li>Logon Type: Normal</li>
<li>User: your OSC user name</li>
<li>Password: Your OSC password</li>
</ol></li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/sftp_1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<p>Transferring files is now just drag and dropping it over to where you want</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/sftp2.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<div class="callout callout-style-default callout-warning callout-titled" title="Make sure you're in the right place!!">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Make sure you’re in the right place!!
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Remember how the filing system at OSC works! To get to the project go to <code>/fs/ess/PAS1640</code> in the OSC side</p>
</div>
</div>
</div>
</section>
</section>
<section id="globus" class="level2">
<h2 class="anchored" data-anchor-id="globus">3.2 Globus</h2>
<p>I’m not going to detail how to use Globus here as Daniel Quiroz has made a great presentation on how to link globus specifically to the DPPC. His presentation can be found in <code>Cooperstone Lab/Data processing PC/Globus/</code> Set up does require booking some time with the DPPC though.</p>
<p>I will mention that the main advantage of Globus is that it is specifically useful for transferring large files and automatically updating them.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>